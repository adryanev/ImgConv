---
status: pending
priority: p1
issue_id: "001"
tags: [code-review, security, xml]
dependencies: []
---

# XXE Vulnerability in XML Parsing

## Problem Statement

The ITBVectorDocument XML parser uses NSXMLParser without disabling external entity processing, exposing the app to XML External Entity (XXE) attacks. Malicious SVG or VectorDrawable files could read local files or make network requests.

**Why it matters:** An attacker could craft a malicious vector file that, when processed, reads sensitive files from the user's system or exfiltrates data to external servers.

## Findings

- **Location:** `ITBVectorDocument.m` - NSXMLParser initialization
- **Evidence:** Parser is created without calling `setShouldResolveExternalEntities:NO`
- **Risk Level:** HIGH - Could expose user data

## Proposed Solutions

### Option A: Disable External Entities (Recommended)
```objc
NSXMLParser *parser = [[NSXMLParser alloc] initWithData:data];
parser.shouldResolveExternalEntities = NO;
parser.shouldProcessNamespaces = YES;
```

**Pros:** Simple one-line fix, no API changes
**Cons:** None
**Effort:** Small
**Risk:** None

### Option B: Use Secure XML Library
Switch to a library with XXE protection built-in (e.g., libxml2 with secure defaults).

**Pros:** More comprehensive protection
**Cons:** Additional dependency, more code changes
**Effort:** Large
**Risk:** Medium - API changes needed

## Recommended Action

_To be filled during triage_

## Technical Details

**Affected Files:**
- `ITBVectorDocument.m`

**Components:**
- XML/SVG parsing
- VectorDrawable parsing

## Acceptance Criteria

- [ ] NSXMLParser configured with `shouldResolveExternalEntities = NO`
- [ ] Tested with malicious XXE payload to verify fix
- [ ] No regression in valid SVG/VectorDrawable parsing

## Work Log

| Date | Action | Learnings |
|------|--------|-----------|
| 2026-01-06 | Created from code review | Security-sentinel agent identified XXE vulnerability |

## Resources

- [OWASP XXE Prevention](https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html)
- [Apple NSXMLParser Documentation](https://developer.apple.com/documentation/foundation/nsxmlparser)
